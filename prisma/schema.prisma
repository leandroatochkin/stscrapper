generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Price {
  id           Int      @id @default(autoincrement())
  store        String
  product_query String
  product_name  String
  brand         String
  price        Int
  promo_text    String?
  url          String?
  scrapedAt    DateTime @default(now())

  @@index([store])
  @@index([product_query])
  @@index([brand])
}

model ScrapeLock {
  id           Int      @id @default(autoincrement())
  store        String
  product_query String
  locked_at     DateTime @default(now())

  @@unique([store, product_query])
}

model Product {
  id           String   @id @default(uuid())
  sku          String   @unique // The unique ID from the store
  name         String
  brand        String
  category     String?
  store        String   // CHANGOMAS, CARREFOUR, etc.
  url          String
  prices       PriceRecord[]
  createdAt    DateTime @default(now())
}

model PriceRecord {
  id             Int      @id @default(autoincrement())
  productId      String
  product        Product  @relation(fields: [productId], references: [id])
  price          Float
  originalPrice  Float?   // Price before discount
  pricePerUnit   Float?   // Price per Liter/Kg
  promoText      String?  // e.g., "2x1", "40% off"
  scrapedAt      DateTime @default(now())

  @@index([scrapedAt])
}

model SearchTrend {
  id           Int      @id @default(autoincrement())
  query        String
  city         String
  province     String
  resultsCount Int
  timestamp    DateTime @default(now())
}