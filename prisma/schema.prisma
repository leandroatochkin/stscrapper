generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Price {
  id           Int      @id @default(autoincrement())
  store        String
  product_query String
  product_name  String
  brand         String
  price        Int
  promo_text    String?
  url          String?
  scrapedAt    DateTime @default(now())

  @@index([store])
  @@index([product_query])
  @@index([brand])
}

model ScrapeLock {
  id           Int      @id @default(autoincrement())
  store        String
  product_query String
  locked_at     DateTime @default(now())

  @@unique([store, product_query])
}

model Product {
  id           String        @id @default(uuid())
  sku          String        @unique 
  name         String
  brandName    String        // Standardized brand name from your CSV logic
  category     String?
  storeId      String
  store        Store         @relation(fields: [storeId], references: [id])
  url          String
  prices       PriceRecord[]
  createdAt    DateTime      @default(now())

  @@index([brandName])
  @@index([storeId])
}

model Store {
  id        String    @id // e.g., "COTO_MDP", "DIA_ALBERTI"
  name      String    // "Coto"
  city      String    // "MAR_DEL_PLATA"
  province  String    // "BUENOS_AIRES"
  products  Product[]
}

model PriceRecord {
  id             Int      @id @default(autoincrement())
  productId      String
  product        Product  @relation(fields: [productId], references: [id])
  price          Float
  originalPrice  Float?   
  discountPct    Float?   // Computed: ((original - price) / original) * 100
  promoText      String?  
  scrapedAt      DateTime @default(now())

  @@index([productId, scrapedAt]) // Crucial for price-over-time graphs
}

model SearchTrend {
  id           Int      @id @default(autoincrement())
  query        String
  city         String
  province     String
  resultsCount Int
  userId       String?  // Optional: to track unique user behavior
  timestamp    DateTime @default(now())

  @@index([query, city])
}